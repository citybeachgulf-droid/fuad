{% extends 'layout.html' %}
{% block content %}

<div class="container py-5" dir="rtl">
  <h3 class="mb-4 fw-bold text-center">طلب تثمين جديد</h3>

  <!-- Progress -->
  <div class="mb-4">
    <div class="progress rounded-pill" style="height: 10px;">
      <div class="progress-bar bg-primary" role="progressbar" style="width: 50%"></div>
    </div>
    <div class="d-flex justify-content-between mt-1">
      <small class="text-muted">الخطوة 1/2: نوع التثمين</small>
      <small class="text-muted">اختر النوع للمتابعة تلقائيًا</small>
    </div>
    <hr>
  </div>

  <!-- Valuation Type Tiles -->
  <form method="POST" id="typeForm">
    <div class="row g-3 mb-4">

      <div class="col-12 col-md-4">
        <label class="card tile-select border rounded-4 p-3 d-flex flex-column align-items-center text-center cursor-pointer shadow-sm">
          <input type="radio" name="valuation_type" value="property" class="d-none" required>
          <div class="tile-icon bg-success bg-opacity-10 text-success rounded-circle d-flex align-items-center justify-content-center mb-3" style="width:60px; height:60px;">
            <i class="bi bi-house fs-3"></i>
          </div>
          <h6 class="fw-bold mb-1">شراء منزل</h6>
          <small class="text-muted">تقييم لغرض الشراء</small>
        </label>
      </div>

      <div class="col-12 col-md-4">
        <label class="card tile-select border rounded-4 p-3 d-flex flex-column align-items-center text-center cursor-pointer shadow-sm">
          <input type="radio" name="valuation_type" value="land" class="d-none" required>
          <div class="tile-icon bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center mb-3" style="width:60px; height:60px;">
            <i class="bi bi-geo fs-3"></i>
          </div>
          <h6 class="fw-bold mb-1">شراء أرض</h6>
          <small class="text-muted">قطعة أرض بدون بناء</small>
        </label>
      </div>

      <div class="col-12 col-md-4">
        <label class="card tile-select border rounded-4 p-3 d-flex flex-column align-items-center text-center cursor-pointer shadow-sm">
          <input type="radio" name="valuation_type" value="house" class="d-none" required>
          <div class="tile-icon bg-warning bg-opacity-10 text-warning rounded-circle d-flex align-items-center justify-content-center mb-3" style="width:60px; height:60px;">
            <i class="bi bi-tools fs-3"></i>
          </div>
          <h6 class="fw-bold mb-1">بناء منزل</h6>
          <small class="text-muted">تقييم لغرض البناء</small>
        </label>
      </div>

    </div>

    <input type="hidden" name="company_id" value="{{ preselected_company_id or '' }}">

    <div class="d-flex justify-content-end gap-2">
      <a href="{{ url_for('client.dashboard') }}" class="btn btn-secondary rounded-3 px-4">إلغاء</a>
      <button class="btn btn-primary rounded-3 px-4" type="submit">متابعة</button>
    </div>
  </form>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
(function(){
  const form = document.getElementById('typeForm');
  document.querySelectorAll('input[name="valuation_type"]').forEach(function(radio){
    radio.addEventListener('change', function(){
      form.requestSubmit();
    });
  });

  // إضافة تأثير اختيار البطاقات
  const tiles = document.querySelectorAll('.tile-select');
  tiles.forEach(tile => {
    tile.addEventListener('click', () => {
      tiles.forEach(t => t.classList.remove('border-primary', 'shadow-lg'));
      tile.classList.add('border-primary', 'shadow-lg');
    });
  });
})();
</script>
{% endblock %}
