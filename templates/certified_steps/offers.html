{% extends 'base.html' %}
{% block title %}تقييم معتمد - عروض التثمين{% endblock %}
{% block content %}
<section class="py-4">
  <div class="container">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h4 m-0">عروض شركات التثمين</h1>
      <div class="d-flex gap-2">
        <a class="btn btn-link" href="{{ url_for('main.certified_property_inputs', entity=entity, purpose=purpose) }}">تعديل المدخلات</a>
        {% if bank %}
        <a class="btn btn-outline-secondary" href="{{ url_for('main.certified_step_bank', entity=entity, purpose=purpose) }}">تغيير البنك</a>
        {% endif %}
      </div>
    </div>

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <div class="row g-3">
          {% if bank %}
          <div class="col-md-3"><span class="text-muted">البنك</span><div class="fw-semibold">{{ bank.user.name if bank.user else bank.slug }}</div></div>
          {% endif %}
          {% if wilaya %}
          <div class="col-md-3"><span class="text-muted">الولاية</span><div class="fw-semibold">{{ wilaya }}</div></div>
          {% endif %}
          {% if region %}
          <div class="col-md-3"><span class="text-muted">الحي/القرية</span><div class="fw-semibold">{{ region }}</div></div>
          {% endif %}
          {% if use %}
          <div class="col-md-3"><span class="text-muted">الاستعمال</span><div class="fw-semibold">{{ use }}</div></div>
          {% endif %}
          {% if land_area %}
          <div class="col-md-3"><span class="text-muted">مساحة الأرض</span><div class="fw-semibold">{{ '{:,}'.format(land_area|int) }} م²</div></div>
          {% endif %}
          {% if build_area and purpose != 'تثمين أرض' %}
          <div class="col-md-3"><span class="text-muted">مساحة البناء</span><div class="fw-semibold">{{ '{:,}'.format(build_area|int) }} م²</div></div>
          {% endif %}
          {% if age and purpose != 'تثمين أرض' %}
          <div class="col-md-3"><span class="text-muted">عمر المبنى</span><div class="fw-semibold">{{ age|int }} سنة</div></div>
          {% endif %}
        </div>
      </div>
    </div>

    {% if companies and companies|length %}
    <div class="vstack gap-2">
      {% for c in companies %}
      <div class="card shadow-sm">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center gap-3">
            {% if c.logo_path %}
            <img src="{{ c.logo_path | static_or_external }}" alt="logo" style="width:48px;height:48px;object-fit:cover;border-radius:10px" class="border bg-white p-1" />
            {% else %}
            <div class="d-flex align-items-center justify-content-center border bg-white" style="width:48px;height:48px;border-radius:10px"><span class="fw-bold">{{ (c.name or '?')[:1] }}</span></div>
            {% endif %}
            <div>
              <div class="fw-semibold">{{ c.name }}</div>
              {% if c.limit_value %}
              <div class="small text-muted">الحد المعتمد: {{ '{:,}'.format(c.limit_value|int) }}</div>
              {% endif %}
            </div>
          </div>
          <div class="d-flex align-items-center gap-3">
            <div class="text-end">
              <div class="small text-muted">التقدير المبدئي</div>
              <div class="h5 m-0 text-primary">{% if c.estimate %}{{ '{:,}'.format(c.estimate|int) }} ر.ع{% else %}—{% endif %}</div>
            </div>
            <div class="text-end">
              <div class="small text-muted">رسوم التثمين</div>
              <div class="h6 m-0">{% if c.valuation_fee %}{{ '{:,}'.format(c.valuation_fee|int) }} ر.ع{% else %}—{% endif %}</div>
            </div>
            <a class="btn btn-primary" href="{{ url_for('client.submit_request') }}?company_id={{ c.id }}">اطلب من هذه الشركة</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-info">لم نجد عروضًا مطابقة للمعايير المدخلة. يمكنك تعديل المدخلات أو تغيير البنك.</div>
    {% endif %}
  </div>
</section>
{% endblock %}
