{% extends 'layout.html' %}
{% block content %}
<div class="row">
  <div class="col-md-3 text-center">
    {% if company.company_profile and company.company_profile.logo_path %}
      <img src="{{ url_for('static', filename=company.company_profile.logo_path) }}" alt="logo" style="max-width:100%; height:120px; object-fit:contain;" class="mb-3">
    {% endif %}
    <h3 class="h5">{{ company.name }}</h3>
    {% if company.company_profile and company.company_profile.website %}
    <p><a href="{{ company.company_profile.website }}" target="_blank">الموقع الإلكتروني</a></p>
    {% endif %}
  </div>
  <div class="col-md-9">
    <div class="mb-3">
      <h4 class="h6">نبذة</h4>
      <p>{{ company.company_profile.about or 'لا توجد نبذة متاحة' }}</p>
    </div>
    <div class="mb-3">
      <h4 class="h6">الخدمات</h4>
      <p>{{ company.company_profile.services or 'لم يتم تحديد الخدمات' }}</p>
    </div>
    <div class="mb-3">
      <h4 class="h6">الحد المالي</h4>
      <p>{% if company.company_profile and company.company_profile.limit_value %}{{ company.company_profile.limit_value }} OMR{% else %}-{% endif %}</p>
    </div>

    <div class="mb-3">
      <h4 class="h6">البنوك المعتمدة لدى الشركة</h4>
      {% set profile = company.company_profile %}
      {% if profile %}
        {% if profile.manual_banks and profile.manual_banks|length > 0 %}
          <ul class="list-group">
            {% for mb in profile.manual_banks %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ mb.name }}{% if mb.phone %} — {{ mb.phone }}{% elif mb.email %} — {{ mb.email }}{% endif %}</span>
              <span class="badge bg-secondary">{% if mb.limit_value %}{{ mb.limit_value }} OMR{% else %}-{% endif %}</span>
            </li>
            {% endfor %}
          </ul>
        {% elif profile.approved_banks and profile.approved_banks|length > 0 %}
          <ul class="list-group">
            {% for ab in profile.approved_banks %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>{{ ab.bank_user.name }}{% if ab.bank_user.phone %} — {{ ab.bank_user.phone }}{% endif %}</span>
              <span class="badge bg-secondary">{% if ab.limit_value %}{{ ab.limit_value }} OMR{% else %}-{% endif %}</span>
            </li>
            {% endfor %}
          </ul>
        {% else %}
          <p>-</p>
        {% endif %}
      {% else %}
        <p>-</p>
      {% endif %}
    </div>

    <div class="mt-4 d-flex gap-2">
      <a class="btn btn-warning" href="{{ url_for('client.submit_request', company_id=company.id) }}">طلب تثمين من هذه الشركة</a>
      {% if current_user.is_authenticated and current_user.role == 'client' %}
      <a class="btn btn-primary" href="{{ url_for('conversations.start_conversation', company_id=company.id) }}">بدء محادثة داخلية</a>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

